<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simon Two-Stage Designs in metabasket • metabasket</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simon Two-Stage Designs in metabasket">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metabasket</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to metabasket</a></li>
    <li><a class="dropdown-item" href="../articles/design_comparison.html">Comparing Basket Trial Designs</a></li>
    <li><a class="dropdown-item" href="../articles/drug_combination_trial.html">Drug Combination Trial: A Practical Example</a></li>
    <li><a class="dropdown-item" href="../articles/simon_designs.html">Simon Designs with metabasket</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tgerke/metabasket" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simon Two-Stage Designs in metabasket</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tgerke/metabasket/blob/main/vignettes/simon_designs.Rmd" class="external-link"><code>vignettes/simon_designs.Rmd</code></a></small>
      <div class="d-none name"><code>simon_designs.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tgerke.github.io/metabasket">metabasket</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Simon two-stage designs (Simon 1989) are the gold standard for
single-arm phase II trials. The <code><a href="https://rdrr.io/pkg/clinfun/man/ph2simon.html" class="external-link">clinfun::ph2simon</a></code> function
provides highly accurate and computationally efficient calculations of
optimal and minimax designs. However, when conducting simulation studies
or designing basket trials with independent Simon designs per basket,
researchers face two common challenges:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Parallelization</strong>: Running thousands of simulations
can be time-consuming</li>
<li>
<strong>Documentation</strong>: Translating design parameters into
clear, shareable protocol language</li>
</ol>
<p>The <code>metabasket</code> package addresses both limitations while
leveraging <code><a href="https://rdrr.io/pkg/clinfun/man/ph2simon.html" class="external-link">clinfun::ph2simon</a></code> for the core design
calculations.</p>
</div>
<div class="section level2">
<h2 id="advantages-of-metabaskets-simon-implementation">Advantages of metabasket’s Simon Implementation<a class="anchor" aria-label="anchor" href="#advantages-of-metabaskets-simon-implementation"></a>
</h2>
<div class="section level3">
<h3 id="parallel-simulation-infrastructure">1. Parallel Simulation Infrastructure<a class="anchor" aria-label="anchor" href="#parallel-simulation-infrastructure"></a>
</h3>
<p><code>metabasket</code> integrates Simon designs with its parallel
simulation framework, enabling:</p>
<ul>
<li>Automatic parallelization via <code>future</code> backend</li>
<li>Progress reporting with <code>progressr</code>
</li>
<li>Consistent interface with other basket trial designs</li>
<li>Operating characteristics calculated across parallel workers</li>
</ul>
</div>
<div class="section level3">
<h3 id="automated-protocol-language-generation">2. Automated Protocol Language Generation<a class="anchor" aria-label="anchor" href="#automated-protocol-language-generation"></a>
</h3>
<p>Generate publication-ready protocol text and export to multiple
formats:</p>
<ul>
<li>Markdown (<code>.md</code>)</li>
<li>HTML (<code>.html</code>)</li>
<li>LaTeX (<code>.tex</code>)</li>
<li>Word (<code>.docx</code>)</li>
<li>R Markdown (<code>.Rmd</code>)</li>
</ul>
<p>This bridges the gap between statistical design and
regulatory/clinical communication.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-simon-design-example">Basic Simon Design Example<a class="anchor" aria-label="anchor" href="#basic-simon-design-example"></a>
</h2>
<div class="section level3">
<h3 id="single-basket-traditional-use-case">Single Basket (Traditional Use Case)<a class="anchor" aria-label="anchor" href="#single-basket-traditional-use-case"></a>
</h3>
<p>Create a Simon optimal design for a single basket:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Design a Simon optimal two-stage trial</span></span>
<span><span class="co"># H0: p &lt;= 0.20 vs H1: p &gt;= 0.40</span></span>
<span><span class="co"># Alpha = 0.10, Power = 0.80</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simon_design.html">simon_design</a></span><span class="op">(</span></span>
<span>  n_baskets <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  basket_names <span class="op">=</span> <span class="st">"NSCLC"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fl">43</span>,  <span class="co"># Maximum sample size</span></span>
<span>  null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  alternative_response_rates <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  design_type <span class="op">=</span> <span class="st">"optimal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simon Two-Stage Design (Parallel Independent Designs)</span></span>
<span><span class="co">#&gt; =====================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Design Type: OPTIMAL </span></span>
<span><span class="co">#&gt;   - optimal: minimizes expected sample size under H0</span></span>
<span><span class="co">#&gt;   - minimax: minimizes maximum sample size</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of cohorts: 1 </span></span>
<span><span class="co">#&gt; Per-cohort error rates:</span></span>
<span><span class="co">#&gt;   - Alpha (type I): 0.1 </span></span>
<span><span class="co">#&gt;   - Beta (type II): 0.2 </span></span>
<span><span class="co">#&gt;   - Power: 0.8 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cohort specifications:</span></span>
<span><span class="co">#&gt;   NSCLC: n=43, p0=0.200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: No information borrowing between cohorts.</span></span>
<span><span class="co">#&gt; For FWER control at level epsilon, use alpha = epsilon / n_baskets (Bonferroni).</span></span></code></pre></div>
<p>The design parameters come directly from
<code><a href="https://rdrr.io/pkg/clinfun/man/ph2simon.html" class="external-link">clinfun::ph2simon</a></code>, ensuring accuracy.</p>
</div>
<div class="section level3">
<h3 id="generate-protocol-language">Generate Protocol Language<a class="anchor" aria-label="anchor" href="#generate-protocol-language"></a>
</h3>
<p>Convert the design to human-readable protocol text suitable for
regulatory submissions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protocol_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_protocol_language.html">generate_protocol_language</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">protocol_text</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Simon Two-Stage Design</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Trial Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This trial uses a Simon two-stage design, the gold standard approach for single-arm phase II trials. The OPTIMAL design has been selected to minimize the expected sample size under the null hypothesis while maintaining the specified Type I error rate and power.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Trial Population</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NSCLC (Maximum N = 43 patients)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The maximum sample size for this trial is 43 patients. The trial uses a Simon two-stage design optimized for single-arm phase II trials.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Statistical Methodology</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This trial uses a Simon two-stage design, the most widely accepted approach for single-arm phase II trials in oncology. The design allows for early stopping if the treatment shows insufficient activity, thereby minimizing patient exposure to ineffective therapy while maintaining appropriate statistical properties.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Two-Stage Design</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Each cohort follows a two-stage design:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 1**: Enroll n1 patients and observe the number of responses r1.</span></span>
<span><span class="co">#&gt; - If responses &lt;= r1, stop for futility (cohort is not promising)</span></span>
<span><span class="co">#&gt; - If responses &gt; r1, continue to Stage 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 2**: Enroll additional patients to reach total sample size n.</span></span>
<span><span class="co">#&gt; - At final analysis, if total responses &gt; r, reject H0 (cohort is promising)</span></span>
<span><span class="co">#&gt; - Otherwise, fail to reject H0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The design parameters (n1, r1, n, r) are calculated using the Simon (1989) method with the following specifications:</span></span>
<span><span class="co">#&gt; - Null response rate (H0): 20.0%</span></span>
<span><span class="co">#&gt; - Alternative response rate (H1): 40.0%</span></span>
<span><span class="co">#&gt; - Type I error rate (per cohort): 0.100</span></span>
<span><span class="co">#&gt; - Type II error rate (per cohort): 0.200</span></span>
<span><span class="co">#&gt; - Optimization criterion: Minimize expected sample size under H0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Hypothesis Testing</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; We test:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; H0: p &lt;= 0.20 (the treatment is not efficacious)</span></span>
<span><span class="co">#&gt; H1: p &gt; 0.20 (the treatment is efficacious)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; where p represents the true response rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Type I Error Control</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The design is calibrated to achieve a Type I error rate of alpha = 0.100, meaning there is at most a 10.0% probability of concluding the treatment is efficacious when the true response rate is at or below the null hypothesis value.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Decision Criteria</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This study aims to identify an improvement in response rate from 20.0% (null hypothesis) to 40.0% (alternative hypothesis) with treatment. Using a two-stage Simon optimal design with 80.0% power and 10.0% alpha (one-sided), participants will be recruited in two stages as follows:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 1 Enrollment and Interim Analysis:**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Enroll **n1 participants** to the first stage</span></span>
<span><span class="co">#&gt; - If **(r1 + 1) or more** participants meet the primary endpoint, proceed to Stage 2</span></span>
<span><span class="co">#&gt; - If **(r1 + 1) or more** participants meet the endpoint prior to enrollment of n1 participants, accrual will continue uninterrupted from Stage 1 to Stage 2</span></span>
<span><span class="co">#&gt; - If **(r1 + 1) or more** participants have not met the endpoint at the time n1 participants have been enrolled, accrual will be held until:</span></span>
<span><span class="co">#&gt;   - **(r1 + 1) or more** participants have met the endpoint (proceed to Stage 2), OR</span></span>
<span><span class="co">#&gt;   - **n1 - (r1 + 1) or more** participants have failed to meet the endpoint (stop for futility)</span></span>
<span><span class="co">#&gt; - If an insufficient number of participants meet the endpoint to proceed to Stage 2, the trial will be stopped for futility at the conclusion of Stage 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 2 Enrollment and Final Analysis:**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - If Stage 2 is opened, enroll additional participants to reach a maximum total of **n participants**</span></span>
<span><span class="co">#&gt; - Success is declared when **(r + 1) or more** participants meet the primary endpoint</span></span>
<span><span class="co">#&gt; - If fewer than (r + 1) participants meet the endpoint, fail to reject the null hypothesis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *Note: The specific design parameters (n1, r1, n, r) will be calculated using the Simon (1989) method based on the above specifications and documented in the Statistical Analysis Plan.*</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Operating Characteristics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The design has been calibrated to achieve:</span></span>
<span><span class="co">#&gt; - Type I error rate: alpha = 0.100 (10.0% probability of false positive)</span></span>
<span><span class="co">#&gt; - Power: &gt;= 80.0% (at alternative response rate of 40.0%)</span></span>
<span><span class="co">#&gt; - Expected sample size: Minimized under H0 (optimal design)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Detailed design parameters (n1, r1, n, r) are calculated using the Simon (1989) method to achieve these operating characteristics.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## References</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Simon R. Optimal two-stage designs for phase II clinical trials. Control Clin Trials. 1989;10(1):1-10.</span></span>
<span><span class="co">#&gt; 2. Jung SH, Lee T, Kim K, George SL. Admissible two-stage designs for phase II cancer clinical trials. Stat Med. 2004;23(4):561-569.</span></span>
<span><span class="co">#&gt; 3. Korn EL, Freidlin B, Abrams JS, Halabi S. Design issues in randomized phase II/III trials. J Clin Oncol. 2012;30(6):667-671.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="export-to-multiple-formats">Export to Multiple Formats<a class="anchor" aria-label="anchor" href="#export-to-multiple-formats"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export to Word for protocol documents</span></span>
<span><span class="fu"><a href="../reference/export_protocol_language.html">export_protocol_language</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"simon_protocol.docx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to LaTeX for publications</span></span>
<span><span class="fu"><a href="../reference/export_protocol_language.html">export_protocol_language</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"simon_protocol.tex"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to HTML for web sharing</span></span>
<span><span class="fu"><a href="../reference/export_protocol_language.html">export_protocol_language</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"simon_protocol.html"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to R Markdown for reproducible reports</span></span>
<span><span class="fu"><a href="../reference/export_protocol_language.html">export_protocol_language</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"simon_protocol.Rmd"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="parallel-basket-trial-with-independent-simon-designs">Parallel Basket Trial with Independent Simon Designs<a class="anchor" aria-label="anchor" href="#parallel-basket-trial-with-independent-simon-designs"></a>
</h2>
<div class="section level3">
<h3 id="multiple-baskets-example">Multiple Baskets Example<a class="anchor" aria-label="anchor" href="#multiple-baskets-example"></a>
</h3>
<p>For basket trials where you want independent testing per basket (no
information borrowing):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Basket trial with 4 disease cohorts</span></span>
<span><span class="co"># Each uses independent Simon design</span></span>
<span><span class="va">design_basket</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simon_design.html">simon_design</a></span><span class="op">(</span></span>
<span>  n_baskets <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  basket_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSCLC"</span>, <span class="st">"SCLC"</span>, <span class="st">"Melanoma"</span>, <span class="st">"RCC"</span><span class="op">)</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  alternative_response_rates <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span> <span class="op">/</span> <span class="fl">4</span>,  <span class="co"># Bonferroni correction for FWER control</span></span>
<span>  beta <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  design_type <span class="op">=</span> <span class="st">"optimal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">design_basket</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simon Two-Stage Design (Parallel Independent Designs)</span></span>
<span><span class="co">#&gt; =====================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Design Type: OPTIMAL </span></span>
<span><span class="co">#&gt;   - optimal: minimizes expected sample size under H0</span></span>
<span><span class="co">#&gt;   - minimax: minimizes maximum sample size</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of cohorts: 4 </span></span>
<span><span class="co">#&gt; Per-cohort error rates:</span></span>
<span><span class="co">#&gt;   - Alpha (type I): 0.0125 </span></span>
<span><span class="co">#&gt;   - Beta (type II): 0.2 </span></span>
<span><span class="co">#&gt;   - Power: 0.8 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cohort specifications:</span></span>
<span><span class="co">#&gt;   NSCLC: n=25, p0=0.200</span></span>
<span><span class="co">#&gt;   SCLC: n=25, p0=0.200</span></span>
<span><span class="co">#&gt;   Melanoma: n=25, p0=0.200</span></span>
<span><span class="co">#&gt;   RCC: n=25, p0=0.200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: No information borrowing between cohorts.</span></span>
<span><span class="co">#&gt; For FWER control at level epsilon, use alpha = epsilon / n_baskets (Bonferroni).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="protocol-language-for-basket-trial">Protocol Language for Basket Trial<a class="anchor" aria-label="anchor" href="#protocol-language-for-basket-trial"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protocol_text_basket</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_protocol_language.html">generate_protocol_language</a></span><span class="op">(</span><span class="va">design_basket</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">protocol_text_basket</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Simon Two-Stage Design for Multi-Cohort Trial</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Trial Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This trial uses independent Simon two-stage designs conducted in parallel across 4 cancer types or subtypes. Each cohort will be analyzed separately without borrowing information across cohorts, providing a conservative approach that protects against inappropriate pooling of heterogeneous treatment effects. The OPTIMAL design has been selected to minimize the expected sample size under the null hypothesis.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Trial Cohorts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. NSCLC (N = 25 patients)</span></span>
<span><span class="co">#&gt; 2. SCLC (N = 25 patients)</span></span>
<span><span class="co">#&gt; 3. Melanoma (N = 25 patients)</span></span>
<span><span class="co">#&gt; 4. RCC (N = 25 patients)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The maximum total sample size for this trial is 100 patients across 4 independent cohorts (25 patients per cohort). Each cohort uses a Simon two-stage design optimized for single-arm phase II trials.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Statistical Methodology</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This trial uses independent Simon two-stage designs conducted in parallel for each cohort. Each cohort is analyzed separately without borrowing information across cohorts. This approach provides a conservative reference standard and is appropriate when treatment effects may be heterogeneous across cancer types.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Two-Stage Design</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Each cohort follows a two-stage design:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 1**: Enroll n1 patients and observe the number of responses r1.</span></span>
<span><span class="co">#&gt; - If responses &lt;= r1, stop for futility (cohort is not promising)</span></span>
<span><span class="co">#&gt; - If responses &gt; r1, continue to Stage 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 2**: Enroll additional patients to reach total sample size n.</span></span>
<span><span class="co">#&gt; - At final analysis, if total responses &gt; r, reject H0 (cohort is promising)</span></span>
<span><span class="co">#&gt; - Otherwise, fail to reject H0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The design parameters (n1, r1, n, r) are calculated using the Simon (1989) method with the following specifications:</span></span>
<span><span class="co">#&gt; - Null response rate (H0): 20.0%</span></span>
<span><span class="co">#&gt; - Alternative response rate (H1): 40.0%</span></span>
<span><span class="co">#&gt; - Type I error rate (per cohort): 0.013</span></span>
<span><span class="co">#&gt; - Type II error rate (per cohort): 0.200</span></span>
<span><span class="co">#&gt; - Optimization criterion: Minimize expected sample size under H0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Hypothesis Testing</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For each cohort j (j = 1, ..., 4), we test:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; H0: p_j &lt;= p0 (the treatment is not efficacious)</span></span>
<span><span class="co">#&gt; H1: p_j &gt; p0 (the treatment is efficacious)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; where p_j represents the true response rate for cohort j and p0 is the null response rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Multiple Testing Adjustment</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To control the family-wise error rate (FWER) across 4 cohorts, a Bonferroni correction is applied. Each individual cohort is tested at significance level alpha = 0.0125. This ensures that the probability of falsely rejecting H0 for at least one cohort is controlled when all null hypotheses are true.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Decision Criteria</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Stage 1 Decision (Futility)**:</span></span>
<span><span class="co">#&gt; For each cohort, if the number of responses in the first n1 patients is &lt;= r1, enrollment to that cohort stops and the treatment is declared not promising for that cohort. Cohorts may continue accrual uninterrupted if (r1 + 1) or more responses are observed before reaching n1 patients.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Final Decision (Efficacy)**:</span></span>
<span><span class="co">#&gt; For cohorts that continue to Stage 2, if the total number of responses is (r + 1) or more across all n patients, the treatment is declared promising for that cohort (H0 is rejected).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Operating Characteristics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The design has been calibrated to achieve:</span></span>
<span><span class="co">#&gt; - Type I error rate per cohort: alpha = 0.0125</span></span>
<span><span class="co">#&gt; - Power per cohort: &gt;= 80.0% (at alternative response rate)</span></span>
<span><span class="co">#&gt; - Expected sample size: Minimized under H0 (optimal design)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## References</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Simon R. Optimal two-stage designs for phase II clinical trials. Control Clin Trials. 1989;10(1):1-10.</span></span>
<span><span class="co">#&gt; 2. Jung SH, Lee T, Kim K, George SL. Admissible two-stage designs for phase II cancer clinical trials. Stat Med. 2004;23(4):561-569.</span></span>
<span><span class="co">#&gt; 3. Korn EL, Freidlin B, Abrams JS, Halabi S. Design issues in randomized phase II/III trials. J Clin Oncol. 2012;30(6):667-671.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-studies-with-parallelization">Simulation Studies with Parallelization<a class="anchor" aria-label="anchor" href="#simulation-studies-with-parallelization"></a>
</h2>
<div class="section level3">
<h3 id="operating-characteristics-via-parallel-simulation">Operating Characteristics via Parallel Simulation<a class="anchor" aria-label="anchor" href="#operating-characteristics-via-parallel-simulation"></a>
</h3>
<p>This is where <code>metabasket</code> truly shines over standalone
<code><a href="https://rdrr.io/pkg/clinfun/man/ph2simon.html" class="external-link">clinfun::ph2simon</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up parallel backend</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enable progress reporting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="st">"progress"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run 10,000 simulations in parallel</span></span>
<span><span class="co"># This would take much longer sequentially!</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_basket_trial.html">simulate_basket_trial</a></span><span class="op">(</span></span>
<span>  <span class="va">design_basket</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  .parallelize <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Key: enables parallel execution</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span> <span class="op">/</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View operating characteristics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset to sequential</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="power-curve-analysis">Power Curve Analysis<a class="anchor" aria-label="anchor" href="#power-curve-analysis"></a>
</h3>
<p>Generate power curves across different response rates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Vector of true response rates to evaluate</span></span>
<span><span class="va">response_rates_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.60</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up parallel backend</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate power for each scenario</span></span>
<span><span class="va">power_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">response_rates_seq</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p_true</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Create design with this true response rate</span></span>
<span>  <span class="va">design_scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simon_design.html">simon_design</a></span><span class="op">(</span></span>
<span>    n_baskets <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    basket_names <span class="op">=</span> <span class="st">"Basket"</span>,</span>
<span>    sample_sizes <span class="op">=</span> <span class="fl">25</span>,</span>
<span>    null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>    alternative_response_rates <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.10</span>,</span>
<span>    beta <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>    design_type <span class="op">=</span> <span class="st">"optimal"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">design_scenario</span><span class="op">$</span><span class="va">response_rates</span> <span class="op">&lt;-</span> <span class="va">p_true</span></span>
<span>  </span>
<span>  <span class="co"># Simulate</span></span>
<span>  <span class="va">sim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_basket_trial.html">simulate_basket_trial</a></span><span class="op">(</span></span>
<span>    <span class="va">design_scenario</span>,</span>
<span>    n_sims <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    .parallelize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.10</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract power (rejection probability)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    true_rate <span class="op">=</span> <span class="va">p_true</span>,</span>
<span>    power <span class="op">=</span> <span class="va">sim_result</span><span class="op">$</span><span class="va">power_per_basket</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    type_i_error <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">p_true</span> <span class="op">&lt;=</span> <span class="fl">0.20</span><span class="op">)</span> <span class="va">sim_result</span><span class="op">$</span><span class="va">power_per_basket</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="kw">else</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine results</span></span>
<span><span class="va">power_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">power_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot power curve</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">power_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">true_rate</span>, y <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.10</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>             alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.20</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>             alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.40</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"green"</span>, </span>
<span>             alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0.20</span>, y <span class="op">=</span> <span class="fl">0.95</span>, label <span class="op">=</span> <span class="st">"H0: p0 = 0.20"</span>, </span>
<span>           hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0.40</span>, y <span class="op">=</span> <span class="fl">0.95</span>, label <span class="op">=</span> <span class="st">"H1: p1 = 0.40"</span>, </span>
<span>           hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Power Curve for Simon Optimal Design"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Based on 5,000 simulations per scenario (parallelized)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"True Response Rate"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Power (Probability of Rejection)"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Dashed lines: Type I error (α = 0.10) at null, target power at alternative"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-interim-analysis-with-simon-design">Advanced: Interim Analysis with Simon Design<a class="anchor" aria-label="anchor" href="#advanced-interim-analysis-with-simon-design"></a>
</h2>
<div class="section level3">
<h3 id="stage-1-analysis">Stage 1 Analysis<a class="anchor" aria-label="anchor" href="#stage-1-analysis"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Simon design</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simon_design.html">simon_design</a></span><span class="op">(</span></span>
<span>  n_baskets <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  basket_names <span class="op">=</span> <span class="st">"NSCLC"</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fl">43</span>,</span>
<span>  null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  alternative_response_rates <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  design_type <span class="op">=</span> <span class="st">"optimal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stage 1 data (e.g., n1 = 18 patients enrolled)</span></span>
<span><span class="va">stage1_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basket_data.html">basket_data</a></span><span class="op">(</span></span>
<span>  basket_names <span class="op">=</span> <span class="st">"NSCLC"</span>,</span>
<span>  n_patients <span class="op">=</span> <span class="fl">18</span>,</span>
<span>  n_responses <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interim analysis</span></span>
<span><span class="va">interim_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_basket.html">analyze_basket</a></span><span class="op">(</span><span class="va">stage1_data</span>, <span class="va">design</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">interim_result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check futility decision</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">interim_result</span><span class="op">$</span><span class="va">futility_stopped</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nTrial stopped for futility at interim.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nTrial continues to Stage 2.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Need to enroll"</span>, <span class="va">design</span><span class="op">$</span><span class="va">sample_sizes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">18</span>, <span class="st">"additional patients.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stage-2-analysis">Stage 2 Analysis<a class="anchor" aria-label="anchor" href="#stage-2-analysis"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After Stage 2 enrollment complete</span></span>
<span><span class="va">full_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basket_data.html">basket_data</a></span><span class="op">(</span></span>
<span>  basket_names <span class="op">=</span> <span class="st">"NSCLC"</span>,</span>
<span>  n_patients <span class="op">=</span> <span class="fl">43</span>,</span>
<span>  n_responses <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Final analysis</span></span>
<span><span class="va">final_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_basket.html">analyze_basket</a></span><span class="op">(</span></span>
<span>  <span class="va">full_data</span>, </span>
<span>  <span class="va">design</span>, </span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span>, </span>
<span>  interim_data <span class="op">=</span> <span class="va">interim_result</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">final_result</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-other-basket-methods">Comparison with Other Basket Methods<a class="anchor" aria-label="anchor" href="#comparison-with-other-basket-methods"></a>
</h2>
<p>A key use case for Simon designs in <code>metabasket</code> is as a
<strong>reference comparator</strong> for information-borrowing
methods:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create designs for comparison</span></span>
<span><span class="va">design_simon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simon_design.html">simon_design</a></span><span class="op">(</span></span>
<span>  n_baskets <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  basket_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSCLC"</span>, <span class="st">"SCLC"</span>, <span class="st">"Melanoma"</span>, <span class="st">"RCC"</span><span class="op">)</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  alternative_response_rates <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span> <span class="op">/</span> <span class="fl">4</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  design_type <span class="op">=</span> <span class="st">"optimal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_bma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basket_design.html">basket_design</a></span><span class="op">(</span></span>
<span>  n_baskets <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  basket_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NSCLC"</span>, <span class="st">"SCLC"</span>, <span class="st">"Melanoma"</span>, <span class="st">"RCC"</span><span class="op">)</span>,</span>
<span>  sample_sizes <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  response_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.40</span>, <span class="fl">0.40</span>, <span class="fl">0.40</span><span class="op">)</span>,</span>
<span>  null_response_rates <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  design_type <span class="op">=</span> <span class="st">"bma"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate both (in parallel)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_simon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_basket_trial.html">simulate_basket_trial</a></span><span class="op">(</span></span>
<span>  <span class="va">design_simon</span>, </span>
<span>  n_sims <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  .parallelize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_bma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_basket_trial.html">simulate_basket_trial</a></span><span class="op">(</span></span>
<span>  <span class="va">design_bma</span>, </span>
<span>  n_sims <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  .parallelize <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare operating characteristics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Simon (no borrowing) - Family-wise Power:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results_simon</span><span class="op">$</span><span class="va">any_rejection</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"BMA (with borrowing) - Family-wise Power:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results_bma</span><span class="op">$</span><span class="va">any_rejection</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
<p>This shows the <strong>gain from information borrowing</strong> in
basket trials.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The <code>metabasket</code> package enhances
<code><a href="https://rdrr.io/pkg/clinfun/man/ph2simon.html" class="external-link">clinfun::ph2simon</a></code> in two critical ways for modern basket
trial research:</p>
<div class="section level3">
<h3 id="parallel-simulation-infrastructure-1">✅ Parallel Simulation Infrastructure<a class="anchor" aria-label="anchor" href="#parallel-simulation-infrastructure-1"></a>
</h3>
<ul>
<li>Leverage multiple CPU cores via <code>future</code> backend</li>
<li>Progress tracking with <code>progressr</code>
</li>
<li>Consistent API with other basket designs</li>
<li>Dramatically faster simulation studies</li>
</ul>
</div>
<div class="section level3">
<h3 id="protocol-language-generation">✅ Protocol Language Generation<a class="anchor" aria-label="anchor" href="#protocol-language-generation"></a>
</h3>
<ul>
<li>Automated translation to human-readable text</li>
<li>Multi-format export (Word, LaTeX, HTML, Markdown, R Markdown)</li>
<li>Bridges statistical design and clinical communication</li>
<li>Version-controlled protocol documentation</li>
</ul>
</div>
<div class="section level3">
<h3 id="when-to-use-simon-designs-in-metabasket">When to Use Simon Designs in metabasket<a class="anchor" aria-label="anchor" href="#when-to-use-simon-designs-in-metabasket"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Reference comparator</strong>: Establish performance without
information borrowing</li>
<li>
<strong>Independent baskets</strong>: When borrowing is
scientifically inappropriate</li>
<li>
<strong>Regulatory conservatism</strong>: When agencies prefer
independent testing</li>
<li>
<strong>Simulation benchmarks</strong>: Compare
information-borrowing methods against gold standard</li>
</ol>
</div>
<div class="section level3">
<h3 id="computational-advantage">Computational Advantage<a class="anchor" aria-label="anchor" href="#computational-advantage"></a>
</h3>
<p>For large simulation studies (e.g., 10,000 replicates × 10
scenarios), parallelization can reduce runtime from <strong>hours to
minutes</strong> on multi-core machines.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Simon R (1989). Optimal two-stage designs for phase II clinical
trials. <em>Controlled Clinical Trials</em>, 10(1):1-10.</p>
<p>Jung SH, Lee T, Kim K, George SL (2004). Admissible two-stage designs
for phase II cancer clinical trials. <em>Statistics in Medicine</em>,
23(4):561-569.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] dplyr_1.1.4           ggplot2_4.0.0         metabasket_0.0.0.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] vctrs_0.6.5        cli_3.6.5          knitr_1.50         rlang_1.1.6       </span></span>
<span><span class="co">#&gt;  [5] xfun_0.54          generics_0.1.4     S7_0.2.0           textshaping_1.0.4 </span></span>
<span><span class="co">#&gt;  [9] jsonlite_2.0.0     glue_1.8.0         htmltools_0.5.8.1  ragg_1.5.0        </span></span>
<span><span class="co">#&gt; [13] sass_0.4.10        scales_1.4.0       rmarkdown_2.30     grid_4.5.2        </span></span>
<span><span class="co">#&gt; [17] tibble_3.3.0       evaluate_1.0.5     jquerylib_0.1.4    fastmap_1.2.0     </span></span>
<span><span class="co">#&gt; [21] yaml_2.3.10        lifecycle_1.0.4    compiler_4.5.2     RColorBrewer_1.1-3</span></span>
<span><span class="co">#&gt; [25] fs_1.6.6           pkgconfig_2.0.3    farver_2.1.2       systemfonts_1.3.1 </span></span>
<span><span class="co">#&gt; [29] digest_0.6.37      R6_2.6.1           tidyselect_1.2.1   pillar_1.11.1     </span></span>
<span><span class="co">#&gt; [33] magrittr_2.0.4     bslib_0.9.0        withr_3.0.2        tools_4.5.2       </span></span>
<span><span class="co">#&gt; [37] gtable_0.3.6       pkgdown_2.2.0      cachem_1.1.0       desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/tgerke" class="external-link">Travis Gerke</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
